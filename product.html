<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Product details | LYRĪON Celestial Couture">
    <title>Product | LYRĪON</title>
    
    <!-- Open Graph -->
<meta property="og:title" content="LYRĪON Celestial Couture">
<meta property="og:description" content="Luxury zodiac-inspired apparel. Wear your sign with intention.">
<meta property="og:image" content="https://lyrion.co.uk/assets/img/og-image.jpg">
<meta property="og:url" content="https://lyrion.co.uk">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="LYRĪON Celestial Couture">
<meta name="twitter:description" content="Luxury zodiac-inspired apparel">
<meta name="twitter:image" content="https://lyrion.co.uk/assets/img/og-image.jpg">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    
    <!-- Navigation -->
    <div class="nav-wrapper" id="mainNav">
        <nav>
            <a href="index.html" class="logo">
                <img src="./assets/img/logo-circle.png" alt="LYRĪON">
                LYRĪON
            </a>
            
           <ul class="nav-links" id="navLinks">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="shop.html">Shop</a></li>
                <li><a href="oracle.html">The Oracle</a></li>
                <li><a href="codex.html">Codex</a></li>
                <li><a href="compatibility.html">Compatibility</a></li>
            </ul>

            <div class="nav-icons">
    <!-- Friend Access Link - ADDED -->
    <a href="plug.html" id="accessLink" style="font-size: 0.75rem; color: rgba(184, 134, 11, 0.8); text-decoration: none; padding: 0.5rem 1rem; border: 1px solid rgba(184, 134, 11, 0.3); border-radius: 20px; transition: all 0.3s ease; margin-right: 1rem;">
        Got a code?
    </a>
    
    <button class="nav-icon" id="searchBtn" aria-label="Search">
        <!-- existing search icon -->
    </button>
            
            <div class="nav-icons">
                <button class="nav-icon" id="searchBtn" aria-label="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>
                
                <!-- Friend Access Indicator -->
<div id="accessIndicator" style="display: none; font-size: 0.75rem; color: var(--color-gold-primary); font-weight: 600; letter-spacing: 1px; padding: 0.5rem 1rem; background: rgba(184, 134, 11, 0.1); border-radius: 20px;">
    TAPPED IN
</div>
                
                <button class="nav-icon" id="cartBtn" aria-label="Shopping cart">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                    </svg>
                    <span class="cart-badge" id="cartBadge">0</span>
                </button>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Product Detail -->
    <section class="section-sm">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb" id="breadcrumb">
                <a href="index.html">Home</a>
                <span>→</span>
                <a href="shop.html">Shop</a>
                <span>→</span>
                <span>Loading...</span>
            </div>
            
            <!-- Product Container -->
            <div class="product-detail-container" id="productContainer">
                <!-- Loading State -->
                <div class="product-images-section">
                    <div class="main-product-image">
                        <div class="skeleton skeleton-image"></div>
                    </div>
                    <div class="product-thumbnails">
                        <div class="thumbnail"><div class="skeleton skeleton-image"></div></div>
                        <div class="thumbnail"><div class="skeleton skeleton-image"></div></div>
                        <div class="thumbnail"><div class="skeleton skeleton-image"></div></div>
                    </div>
                </div>
                
                <div class="product-info-section">
                    <div class="skeleton skeleton-text" style="width: 40%; height: 20px; margin-bottom: 1rem;"></div>
                    <div class="skeleton skeleton-title" style="height: 50px; margin-bottom: 1rem;"></div>
                    <div class="skeleton skeleton-text" style="width: 60%; height: 30px; margin-bottom: 2rem;"></div>
                    <div class="skeleton skeleton-text" style="width: 100%; height: 100px;"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>LYRĪON</h4>
                    <p>Celestial couture made in England. Wear your sign with intention.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Shop</h4>
                    <ul class="footer-links">
                        <li><a href="shop.html?category=Men">Men's Collection</a></li>
                        <li><a href="shop.html?category=Women">Women's Collection</a></li>
                        <li><a href="shop.html?category=Moon Girls">Moon Girls</a></li>
                        <li><a href="shop.html?category=Star Boys">Star Boys</a></li>
                        <li><a href="shop.html?category=Home">Home & Altar</a></li>
                        <li><a href="shop.html?category=Accessories">Accessories</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Explore</h4>
                    <ul class="footer-links">
                        <li><a href="oracle.html">The Oracle</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="codex.html">Codex</a></li>
                        <li><a href="compatibility.html">Compatibility</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul class="footer-links">
                        <li><a href="shipping.html">Shipping & Returns</a></li>
                        <li><a href="care-guide.html">Care Instructions</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                        <li><a href="terms.html">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 LYRĪON Celestial Couture. All rights reserved. Made with intention in England.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Drawer -->
    <div class="cart-overlay" id="cartOverlay"></div>
    <div class="cart-drawer" id="cartDrawer">
        <div class="cart-header">
            <h3 class="cart-title">Your Cart</h3>
            <button class="cart-close" id="cartClose" aria-label="Close cart">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <div class="cart-items" id="cartItems"></div>
        
        <div class="cart-footer">
            <div class="cart-total">
                <span class="cart-total-label">Total</span>
                <span class="cart-total-value" id="cartTotal">£0.00</span>
            </div>
            <a href="checkout.html" class="btn btn-primary btn-full">Proceed to Checkout</a>
        </div>
    </div>

    <!-- Search Overlay -->
    <div class="search-overlay" id="searchOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(15, 13, 11, 0.95); backdrop-filter: blur(8px); z-index: 3000; padding: 2rem;">
        <div class="container-narrow" style="margin-top: 5rem;">
            <button id="searchClose" style="position: absolute; top: 2rem; right: 2rem; color: var(--color-cream); font-size: 2rem; background: none; border: none; cursor: pointer;">&times;</button>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search products, zodiac signs..." style="border-color: var(--color-gold-accent);">
                <span class="search-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </span>
            </div>
            
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/cart.js"></script>
    <script src="assets/js/search.js"></script>
    
    <script>
    // Product Detail Logic
    let currentProduct = null;
    let selectedVariant = null;
    let currentImageIndex = 0;
    let productImages = [];
    
    // Load product on page load
    document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const sku = urlParams.get('sku');
        
        if (!sku) {
            showError('No product specified');
            return;
        }
        
        try {
            // Load products
            const response = await fetch('data/products.json');
            const products = await response.json();
            
            // Find product
            currentProduct = products.find(p => p.sku === sku);
            
            if (!currentProduct) {
                showError('Product not found');
                return;
            }
            
            // Render product
            renderProduct(currentProduct);
            updateBreadcrumb(currentProduct);
            
        } catch (error) {
            console.error('Error loading product:', error);
            showError('Unable to load product');
        }
    });
    
    // Render product with gallery
    function renderProduct(product) {
        const container = document.getElementById('productContainer');
        
        // Build image array from product data
        productImages = [
            product.image_front,
            product.image_back,
            product.image_side,
            product.image_detail
        ].filter(img => img && img.trim() !== ''); // Only include non-empty images
        
        // If no images, add a placeholder
        if (productImages.length === 0) {
            productImages = ['placeholder.png'];
        }
        
        // Check if product has variant pricing
        const hasVariantPricing = product.variants && Array.isArray(product.variants) && 
                                 product.variants.length > 0 && typeof product.variants[0] === 'object';
        
        // Get initial price
        let initialPrice = parseFloat(product.price);
        let initialComparePrice = parseFloat(product.compare_at_price) || 0;
        
        if (hasVariantPricing && product.variants.length > 0) {
            selectedVariant = product.variants[0];
            initialPrice = parseFloat(selectedVariant.price);
        } else if (product.variants && Array.isArray(product.variants)) {
            // Old format: just array of sizes
            selectedVariant = product.variants[0];
        }
        
        // Build size selector
        const hasSizes = product.variants && product.variants.length > 0;
        
        const sizeSelector = hasSizes ? `
            <div class="size-selector">
                <label class="size-selector-label">Select Size</label>
                <div class="size-options" id="sizeOptions">
                    ${hasVariantPricing ? 
                        product.variants.map((variant, index) => `
                            <button class="size-option ${index === 0 ? 'active' : ''}" 
                                    data-size="${variant.size}" 
                                    data-price="${variant.price}"
                                    onclick="selectSize('${variant.size}', ${variant.price})">
                                ${variant.size}
                            </button>
                        `).join('') 
                        : 
                        product.variants.map((size, index) => `
                            <button class="size-option ${index === 0 ? 'active' : ''}" 
                                    data-size="${size}"
                                    onclick="selectSize('${size}', ${product.price})">
                                ${size}
                            </button>
                        `).join('')
                    }
                </div>
            </div>
        ` : '';
        
        container.innerHTML = `
            <div class="product-images-section">
                <!-- Image Zoom Overlay -->
                <div class="image-zoom-overlay" id="imageZoomOverlay">
                    <img class="zoomed-image" id="zoomedImage" alt="${product.title}">
                </div>
                
                <!-- Main Image with Navigation -->
                <div class="main-product-image fade" id="mainImageContainer">
                    <img id="mainImage" 
                         src="assets/products/${productImages[0]}" 
                         alt="${product.title}" 
                         onerror="this.src='assets/img/placeholder.png'"
                         onclick="openImageZoom()">
                    
                    ${productImages.length > 1 ? `
                        <!-- Navigation Buttons -->
                        <div class="gallery-nav-buttons">
                            <button class="gallery-nav-button" onclick="changeImage(-1)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <button class="gallery-nav-button" onclick="changeImage(1)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Image Count Badge -->
                        <div class="image-count-badge">
                            ${currentImageIndex + 1} / ${productImages.length}
                        </div>
                    ` : ''}
                </div>
                
                <!-- Thumbnails -->
                <div class="product-thumbnails" id="thumbnailContainer">
                    ${productImages.length > 1 ? 
                        productImages.map((img, index) => `
                            <div class="thumbnail ${index === 0 ? 'active' : ''}" 
                                 data-index="${index}"
                                 onclick="selectImage(${index})">
                                <img src="assets/products/${img}" 
                                     alt="${product.title} - View ${index + 1}"
                                     onerror="this.src='assets/img/placeholder.png'">
                            </div>
                        `).join('') 
                        : 
                        '<div class="thumbnail active no-image" style="aspect-ratio: 1/1;">No additional images</div>'
                    }
                </div>
                
                <!-- Gallery Indicators -->
                ${productImages.length > 1 ? `
                    <div class="gallery-indicators" id="galleryIndicators">
                        ${productImages.map((_, index) => `
                            <div class="gallery-indicator ${index === 0 ? 'active' : ''}" 
                                 onclick="selectImage(${index})"></div>
                        `).join('')}
                    </div>
                ` : ''}
            </div>
            
            <div class="product-info-section">
                <div class="product-badges">
                    ${product.compare_at_price > 0 ? '<span class="badge badge-sale">Sale</span>' : ''}
                    ${product.category === 'Men' || product.category === 'Women' ? '<span class="badge badge-england">Made in England</span>' : ''}
                </div>
                
                <h1 class="product-title-main">${product.title}</h1>
                <p class="product-subtitle">${product.category}${product.zodiac_sign && product.zodiac_sign !== 'None' ? ` • ${product.zodiac_sign}` : ''}</p>
                
                <div class="product-price-main" id="productPriceMain">
                    <span class="price-main-current" id="currentPrice">£${initialPrice.toFixed(2)}</span>
                    ${initialComparePrice > 0 ? `<span class="price-main-compare" id="comparePrice">£${initialComparePrice.toFixed(2)}</span>` : ''}
                </div>
                
                <div class="product-description-main">
                    ${product.description}
                </div>
                
                ${sizeSelector}
                
                <button id="addToCartBtn" class="btn btn-primary btn-full mb-md" style="font-size: 1.1rem; padding: 1rem 2rem;">
                    Add to Cart
                </button>
                
                <div class="product-meta">
                    <div class="meta-item">
                        <span class="meta-label">Category</span>
                        <span class="meta-value">${product.category}</span>
                    </div>
                    ${product.zodiac_sign && product.zodiac_sign !== 'None' ? `
                        <div class="meta-item">
                            <span class="meta-label">Zodiac</span>
                            <span class="meta-value">${product.zodiac_sign}</span>
                        </div>
                    ` : ''}
                    <div class="meta-item">
                        <span class="meta-label">SKU</span>
                        <span class="meta-value">${product.sku}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Delivery</span>
                        <span class="meta-value">5-7 Business Days</span>
                    </div>
                </div>
            </div>
        `;
        
        // Setup interactions
        setupProductInteractions();
    }
    
    // Select size function - updates price and selected variant
    window.selectSize = function(size, price) {
        // Update selected variant
        selectedVariant = size;
        
        // Update active state of size buttons
        document.querySelectorAll('.size-option').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.size === size) {
                btn.classList.add('active');
            }
        });
        
        // Update price display
        const currentPriceElement = document.getElementById('currentPrice');
        const priceElement = document.getElementById('productPriceMain');
        
        if (currentPriceElement) {
            currentPriceElement.textContent = `£${parseFloat(price).toFixed(2)}`;
            
            // Add price change animation
            priceElement.classList.add('price-change');
            setTimeout(() => {
                priceElement.classList.remove('price-change');
            }, 300);
        }
        
        // Find variant data if product has variant pricing
        if (currentProduct && currentProduct.variants && currentProduct.variants.length > 0) {
            const variant = currentProduct.variants.find(v => 
                typeof v === 'object' ? v.size === size : v === size
            );
            
            // If variant has compare price, update that too
            const comparePriceElement = document.getElementById('comparePrice');
            if (comparePriceElement && variant && variant.compare_at_price) {
                comparePriceElement.textContent = `£${parseFloat(variant.compare_at_price).toFixed(2)}`;
            } else if (comparePriceElement && currentProduct.compare_at_price > 0) {
                comparePriceElement.textContent = `£${parseFloat(currentProduct.compare_at_price).toFixed(2)}`;
            }
        }
    };
    
    // Gallery Functions
    window.selectImage = function(index) {
        if (index < 0 || index >= productImages.length || index === currentImageIndex) return;
        
        // Update main image
        const mainImage = document.getElementById('mainImage');
        const mainImageContainer = document.getElementById('mainImageContainer');
        
        // Add fade effect
        mainImageContainer.classList.add('fade');
        setTimeout(() => {
            mainImage.src = `assets/products/${productImages[index]}`;
            mainImageContainer.classList.remove('fade');
        }, 150);
        
        // Update active thumbnail
        document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
            thumb.classList.toggle('active', i === index);
        });
        
        // Update active indicator
        document.querySelectorAll('.gallery-indicator').forEach((indicator, i) => {
            indicator.classList.toggle('active', i === index);
        });
        
        // Update image count badge
        const badge = document.querySelector('.image-count-badge');
        if (badge) {
            badge.textContent = `${index + 1} / ${productImages.length}`;
        }
        
        currentImageIndex = index;
    };
    
    window.changeImage = function(direction) {
        let newIndex = currentImageIndex + direction;
        
        if (newIndex < 0) {
            newIndex = productImages.length - 1;
        } else if (newIndex >= productImages.length) {
            newIndex = 0;
        }
        
        selectImage(newIndex);
    };
    
    window.openImageZoom = function() {
        if (productImages.length === 0) return;
        
        const overlay = document.getElementById('imageZoomOverlay');
        const zoomedImage = document.getElementById('zoomedImage');
        
        zoomedImage.src = document.getElementById('mainImage').src;
        overlay.classList.add('active');
        
        // Close on click
        overlay.onclick = function(e) {
            if (e.target === overlay || e.target.classList.contains('zoomed-image')) {
                overlay.classList.remove('active');
            }
        };
        
        // Close on escape key
        document.addEventListener('keydown', function closeOnEscape(e) {
            if (e.key === 'Escape') {
                overlay.classList.remove('active');
                document.removeEventListener('keydown', closeOnEscape);
            }
        });
    };
    
    // Setup product interactions
    function setupProductInteractions() {
        // Add to cart
        const addToCartBtn = document.getElementById('addToCartBtn');
        if (addToCartBtn) {
            addToCartBtn.addEventListener('click', () => {
                if (window.CartAPI) {
                    window.CartAPI.addToCart(currentProduct, selectedVariant);
                } else {
                    // Fallback cart function
                    addToCartFallback();
                }
            });
        }
        
        // Keyboard navigation for gallery
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                changeImage(-1);
            } else if (e.key === 'ArrowRight') {
                changeImage(1);
            }
        });
    }
    
    // Fallback add to cart function
    function addToCartFallback() {
        let cart = JSON.parse(localStorage.getItem('lyrion_cart') || '[]');
        
        const cartItem = {
            sku: currentProduct.sku,
            title: currentProduct.title,
            price: currentProduct.price,
            image: currentProduct.image_front,
            quantity: 1,
            variant: selectedVariant
        };
        
        cart.push(cartItem);
        localStorage.setItem('lyrion_cart', JSON.stringify(cart));
        
        // Update cart badge
        const badge = document.getElementById('cartBadge');
        if (badge) {
            badge.textContent = cart.length;
        }
        
        // Show success message
        alert(`${currentProduct.title} added to cart!`);
        
        // Optional: Open cart drawer
        const cartDrawer = document.getElementById('cartDrawer');
        const cartOverlay = document.getElementById('cartOverlay');
        if (cartDrawer && cartOverlay) {
            cartDrawer.classList.add('active');
            cartOverlay.classList.add('active');
        }
    }
    
    // Update breadcrumb
    function updateBreadcrumb(product) {
        const breadcrumb = document.getElementById('breadcrumb');
        breadcrumb.innerHTML = `
            <a href="index.html">Home</a>
            <span>→</span>
            <a href="shop.html">Shop</a>
            <span>→</span>
            <a href="shop.html?category=${encodeURIComponent(product.category)}">${product.category}</a>
            <span>→</span>
            <span>${product.title}</span>
        `;
    }
    
    // Show error
    function showError(message) {
        const container = document.getElementById('productContainer');
        container.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 4rem 2rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.3;">✦</div>
                <h2 style="margin-bottom: 1rem;">${message}</h2>
                <a href="shop.html" class="btn btn-primary">Back to Shop</a>
            </div>
        `;
    }
</script>

<script>
    // Show access indicator if active
    document.addEventListener('DOMContentLoaded', () => {
        const accessData = JSON.parse(sessionStorage.getItem('lyrion_access') || 'null');
        
        if (accessData && accessData.code) {
            const indicator = document.getElementById('accessIndicator');
            if (indicator) {
                indicator.style.display = 'block';
                indicator.title = `Friend access via ${accessData.owner}`;
            }
        }
    });
</script>

<script>
// Show access indicator if friend access is active
document.addEventListener('DOMContentLoaded', () => {
    const accessData = JSON.parse(sessionStorage.getItem('lyrion_access') || 'null');
    
    if (accessData && accessData.code) {
        // Hide the "Got a code?" link since they already have access
        const accessLink = document.getElementById('accessLink');
        if (accessLink) {
            accessLink.style.display = 'none';
        }
        
        // Create and show the "TAPPED IN" indicator
        const navIcons = document.querySelector('.nav-icons');
        if (navIcons) {
            const indicator = document.createElement('div');
            indicator.id = 'accessIndicator';
            indicator.style.cssText = `
                font-size: 0.75rem;
                color: var(--color-gold-primary);
                font-weight: 600;
                letter-spacing: 1px;
                padding: 0.5rem 1rem;
                background: rgba(184, 134, 11, 0.1);
                border-radius: 20px;
                margin-right: 1rem;
                border: 1px solid var(--color-gold-primary);
            `;
            indicator.textContent = 'TAPPED IN';
            indicator.title = `Friend access via ${accessData.owner}`;
            
            // Insert before search button
            const searchBtn = document.getElementById('searchBtn');
            navIcons.insertBefore(indicator, searchBtn);
        }
    }
});
</script>
</body>
</html>